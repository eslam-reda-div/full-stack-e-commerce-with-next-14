(()=>{var e={};e.id=925,e.ids=[925],e.modules={55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},13156:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>n.a,__next_app__:()=>h,originalPathname:()=>m,pages:()=>d,routeModule:()=>p,tree:()=>u});var s=r(73137),a=r(54647),o=r(4183),n=r.n(o),c=r(71775),i={};for(let e in c)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(i[e]=()=>c[e]);r.d(t,i);let l=s.AppPageRouteModule,u=["",{children:["(pages)",{children:["checkout",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,28449)),"C:\\Users\\eslam\\OneDrive\\سطح المكتب\\cv\\full-stack-e-commerce-with-next-14\\src\\app\\(pages)\\checkout\\page.tsx"]}]},{}]},{"not-found":[()=>Promise.resolve().then(r.bind(r,45653)),"C:\\Users\\eslam\\OneDrive\\سطح المكتب\\cv\\full-stack-e-commerce-with-next-14\\src\\app\\(pages)\\not-found.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,82645)),"C:\\Users\\eslam\\OneDrive\\سطح المكتب\\cv\\full-stack-e-commerce-with-next-14\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,51918,23)),"next/dist/client/components/not-found-error"]}],d=["C:\\Users\\eslam\\OneDrive\\سطح المكتب\\cv\\full-stack-e-commerce-with-next-14\\src\\app\\(pages)\\checkout\\page.tsx"],m="/(pages)/checkout/page",h={require:r,loadChunk:()=>Promise.resolve()},p=new l({definition:{kind:a.x.APP_PAGE,page:"/(pages)/checkout/page",pathname:"/checkout",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:u}})},20250:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,42796,23)),Promise.resolve().then(r.bind(r,30083))},30083:(e,t,r)=>{"use strict";r.r(t),r.d(t,{CheckoutPage:()=>q});var s=r(60080),a=r(9885),o=r.n(a),n=r(65140),c=r(14041),i=r(11440),l=r.n(i),u=r(57114),d=r(39496),m=r(73185),h=r(8693),p=r(17644),x=r(9876),_=r(67705),g=r.n(_),f=r(42655),j=r(59974),k=r(32366),v=r.n(k);let y=()=>{let e=(0,n.MD)(),t=(0,n.lq)(),[r,c]=o().useState(null),[i,l]=o().useState(!1),m=(0,u.useRouter)(),{cart:h,cartTotal:x}=(0,p.j)(),[_,g]=o().useState("test"),k=(0,a.useCallback)(async r=>{r.preventDefault(),l(!0);try{let{error:r,paymentIntent:s}=await e?.confirmPayment({elements:t,redirect:"if_required",confirmParams:{return_url:"http://localhost:3000/order-confirmation"}});if(r&&(c(r.message),l(!1)),s)try{let e=await fetch("http://localhost:3000/api/orders",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({total:x.raw,address:_,stripePaymentIntentID:s.id,items:(h?.items||[])?.map(({product:e,quantity:t})=>({product:"string"==typeof e?e:e.id,quantity:t,price:"object"==typeof e?j.priceFromJSON(e.priceJSON,1,!0):void 0}))})});if(!e.ok)throw Error(e.statusText||"Something went wrong.");let{error:t,doc:r}=await e.json();if(t)throw Error(t);m.push(`/order-confirmation?order_id=${r.id}`)}catch(e){console.error(e.message),m.push(`/order-confirmation?error=${encodeURIComponent(e.message)}`)}}catch(t){let e=t instanceof Error?t.message:"Something went wrong.";c(`Error while submitting payment: ${e}`),l(!1)}},[e,t,x.raw,_,h?.items,m]);return(0,s.jsxs)("form",{onSubmit:k,className:v().form,children:[r&&s.jsx(f.v,{error:r}),s.jsx(n.Hn,{}),s.jsx(n.H3,{options:{mode:"shipping",allowedCountries:["ُEG"],fields:{phone:"always"}},onChange:e=>{g(e.value.address.line1),console.log(_)}}),(0,s.jsxs)("div",{className:v().actions,children:[s.jsx(d.Button,{label:"Back to cart",href:"/cart",appearance:"secondary"}),s.jsx(d.Button,{label:i?"Loading...":"Checkout",type:"submit",appearance:"primary",disabled:!e||i})]})]})};var b=r(88995),C=r(20096),P=r.n(C);let w=({product:e,title:t,metaImage:r,quantity:a,index:o})=>(0,s.jsxs)("li",{className:P().item,children:[(0,s.jsxs)(l(),{href:`/products/${e.slug}`,className:P().mediaWrapper,children:[!r&&s.jsx("span",{children:"No image"}),r&&"string"!=typeof r&&s.jsx(b.p,{className:P().media,imgClassName:P().image,resource:r,fill:!0})]}),(0,s.jsxs)("div",{className:P().itemDetails,children:[(0,s.jsxs)("div",{className:P().titleWrapper,children:[s.jsx("h6",{children:t}),s.jsx(j.Price,{product:e,button:!1})]}),(0,s.jsxs)("p",{className:P().quantity,children:["x",a]})]}),s.jsx("div",{className:P().subtotal,children:s.jsx(j.Price,{product:e,button:!1,quantity:a})})]},o);var N=r(12815),I=r.n(N);let S=(0,c.J)("pk_test_51H7k5NH9RHdRyF0gLNK8qDe6NRnUQPLmVkFhL9oc24tzKouCoeoHejbeEdHvzMNJZd59acbeQtO7IcTvk3RpZieV00HnCetu07"),q=e=>{let{settings:{productsPage:t}}=e,{user:r}=(0,h.a)(),c=(0,u.useRouter)(),[i,_]=o().useState(null),[f,j]=o().useState(),k=o().useRef(!1),{theme:v}=(0,x.F)(),{cart:b,cartIsEmpty:C,cartTotal:P}=(0,p.j)();return((0,a.useEffect)(()=>{null!==r&&C&&c.push("/cart")},[c,r,C]),(0,a.useEffect)(()=>{if(r&&b&&!1===k.current){k.current=!0;let e=async()=>{try{let e=await fetch("http://localhost:3000/api/create-payment-intent",{method:"POST",credentials:"include"}),t=await e.json();t.error?_(t.error):t.client_secret&&(_(null),j(t.client_secret))}catch(e){_("Something went wrong.")}};e()}},[b,r]),r&&S)?(0,s.jsxs)(a.Fragment,{children:[C&&(0,s.jsxs)("div",{children:["Your ",s.jsx(l(),{href:"/cart",children:"cart"})," is empty.","object"==typeof t&&t?.slug&&(0,s.jsxs)(a.Fragment,{children:[" ",s.jsx(l(),{href:`/${t.slug}`,children:"Continue shopping?"})]})]}),!C&&(0,s.jsxs)("div",{className:I().items,children:[(0,s.jsxs)("div",{className:I().header,children:[s.jsx("p",{children:"Products"}),(0,s.jsxs)("div",{className:I().headerItemDetails,children:[s.jsx("p",{}),s.jsx("p",{className:I().quantity,children:"Quantity"})]}),s.jsx("p",{className:I().subtotal,children:"Subtotal"})]}),(0,s.jsxs)("ul",{children:[b?.items?.map((e,t)=>{if("object"==typeof e.product){let{quantity:r,product:o,product:{title:n,meta:c}}=e;if(!r)return null;let i=c?.image;return s.jsx(a.Fragment,{children:s.jsx(w,{product:o,title:n,metaImage:i,quantity:r,index:t})},t)}return null}),(0,s.jsxs)("div",{className:I().orderTotal,children:[s.jsx("p",{children:"Order Total"}),s.jsx("p",{children:P.formatted})]})]})]}),!f&&!i&&s.jsx("div",{className:I().loading,children:s.jsx(m.h,{number:2})}),!f&&i&&(0,s.jsxs)("div",{className:I().error,children:[s.jsx("p",{children:`Error: ${i}`}),s.jsx(d.Button,{label:"Back to cart",href:"/cart",appearance:"secondary"})]}),f&&(0,s.jsxs)(a.Fragment,{children:[s.jsx("h3",{className:I().payment,children:"Payment Details"}),i&&s.jsx("p",{children:`Error: ${i}`}),s.jsx(n.eK,{stripe:S,options:{clientSecret:f,appearance:{theme:"stripe",variables:{colorText:"dark"===v?g().colors.base0:g().colors.base1000,fontSizeBase:"16px",fontWeightNormal:"500",fontWeightBold:"600",colorBackground:"dark"===v?g().colors.base850:g().colors.base0,fontFamily:"Inter, sans-serif",colorTextPlaceholder:g().colors.base500,colorIcon:"dark"===v?g().colors.base0:g().colors.base1000,borderRadius:"0px",colorDanger:g().colors.error500,colorDangerText:g().colors.error500}}},children:s.jsx(y,{})})]})]}):null}},73185:(e,t,r)=>{"use strict";r.d(t,{h:()=>n});var s=r(60080);r(9885);var a=r(72215),o=r.n(a);let n=e=>{let t=Array.from(Array(e.number||1).keys());return s.jsx("div",{className:o().loading,children:t.map((e,t)=>s.jsx("div",{className:o().shimmer},t))})}},88995:(e,t,r)=>{"use strict";r.d(t,{p:()=>c});var s=r(60080),a=r(9885),o=r(94011),n=r(70966);let c=e=>{let{className:t,resource:r,htmlElement:c="div"}=e,i="string"!=typeof r&&r?.mimeType?.includes("video"),l=c||a.Fragment;return s.jsx(l,{...null!==c?{className:t}:{},children:i?s.jsx(n.Video,{...e}):s.jsx(o.Image,{...e})})}},42655:(e,t,r)=>{"use strict";r.d(t,{v:()=>n});var s=r(60080);r(9885);var a=r(8514),o=r.n(a);let n=({message:e,error:t,success:r,warning:a,className:n})=>{let c=e||t||r||a;return c?s.jsx("div",{className:[o().message,n,t&&o().error,r&&o().success,a&&o().warning,!t&&!r&&!a&&o().default].filter(Boolean).join(" "),children:c}):null}},32366:e=>{e.exports={form:"CheckoutForm_form__UhcpU",actions:"CheckoutForm_actions__dvYjH"},e.exports.__checksum="df58128d7cfa"},20096:e=>{e.exports={item:"CheckoutItem_item__cxCFA",mediaWrapper:"CheckoutItem_mediaWrapper__nq8fa",media:"CheckoutItem_media__WFGoI",image:"CheckoutItem_image__zkSL6",itemDetails:"CheckoutItem_itemDetails__J6Tve",titleWrapper:"CheckoutItem_titleWrapper__LWhvI",quantity:"CheckoutItem_quantity__dlFv7",subtotal:"CheckoutItem_subtotal__8JJtA"},e.exports.__checksum="2cae2051e139"},12815:e=>{e.exports={items:"CheckoutPage_items__BRLyq",header:"CheckoutPage_header__uEemM",headerItemDetails:"CheckoutPage_headerItemDetails__OwApE",headersubtotal:"CheckoutPage_headersubtotal__d2wQg",subtotal:"CheckoutPage_subtotal__sG0ES",orderTotal:"CheckoutPage_orderTotal__c5Lxw",payment:"CheckoutPage_payment__mXReJ",loading:"CheckoutPage_loading__EpVBZ",error:"CheckoutPage_error__NyGE5"},e.exports.__checksum="b08336594c5b"},44900:e=>{e.exports={checkout:"checkout_checkout__iVwRz"},e.exports.__checksum="5f91ae5c93ce"},72215:e=>{e.exports={loading:"LoadingShimmer_loading__sK7Rg",shimmer:"LoadingShimmer_shimmer__YtrFI"},e.exports.__checksum="eba6cbe2403e"},8514:e=>{e.exports={message:"Message_message__z1tdG",default:"Message_default__RDDb4",warning:"Message_warning__FT9n8",error:"Message_error__WX2fA",success:"Message_success__Cnnxv"},e.exports.__checksum="21e7800cf184"},28449:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>x,metadata:()=>_});var s=r(48144);r(53830);var a=r(28996),o=r(53205),n=r(1978),c=r(62208),i=r(17536);let l=(0,i.createProxy)(String.raw`C:\Users\eslam\OneDrive\سطح المكتب\cv\full-stack-e-commerce-with-next-14\src\app\(pages)\checkout\CheckoutPage\index.tsx`),{__esModule:u,$$typeof:d}=l;l.default;let m=l.CheckoutPage;var h=r(44900),p=r.n(h);async function x(){await (0,n.S)({nullUserRedirect:`/login?error=${encodeURIComponent("You must be logged in to checkout.")}&redirect=${encodeURIComponent("/checkout")}`});let e=null;try{e=await (0,a.wv)()}catch(e){console.error(e)}return s.jsx("div",{className:p().checkoutPage,children:s.jsx(o.T,{className:p().checkoutPage,children:s.jsx(m,{settings:e})})})}let _={title:"Account",description:"Create an account or log in to your existing account.",openGraph:(0,c.T)({title:"Account",url:"/account"})}},1978:(e,t,r)=>{"use strict";r.d(t,{S:()=>o});var s=r(59859),a=r(6465);let o=async e=>{let{nullUserRedirect:t,validUserRedirect:r}=e||{},o=(0,s.cookies)(),n=o.get("payload-token")?.value,c=await fetch("http://localhost:3000/api/users/me",{headers:{Authorization:`JWT ${n}`}}),{user:i}=await c.json();return r&&c.ok&&i&&(0,a.redirect)(r),!t||c.ok&&i||(0,a.redirect)(t),{user:i,token:n}}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[4650,2560,6724,3497,9859,6465,8030,1840,8667,5072,12,9974],()=>r(13156));module.exports=s})();