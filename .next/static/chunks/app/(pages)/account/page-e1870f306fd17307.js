(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[524],{9899:function(e,r,t){Promise.resolve().then(t.bind(t,6354))},6354:function(e,r,t){"use strict";t.r(r);var o=t(7437),a=t(2265),n=t(1865),s=t(4033),l=t(4780),i=t(6399),c=t(1752),u=t(7992),d=t(8967),p=t.n(d);r.default=()=>{let[e,r]=(0,a.useState)(""),[t,d]=(0,a.useState)(""),{user:h,setUser:m}=(0,u.a)(),[f,_]=(0,a.useState)(!1),{register:g,handleSubmit:w,formState:{errors:y,isLoading:v},reset:b,watch:j}=(0,n.cI)(),x=(0,a.useRef)({});x.current=j("password","");let k=(0,s.useRouter)(),C=(0,a.useCallback)(async e=>{if(h){let t=await fetch("".concat("http://localhost:3000","/api/users/").concat(h.id),{credentials:"include",method:"PATCH",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}});if(t.ok){let e=await t.json();m(e.doc),d("Successfully updated account."),r(""),_(!1),b({email:e.doc.email,name:e.doc.name,phone:e.doc.phone,password:"",passwordConfirm:""})}else r("There was a problem updating your account.")}},[h,m,b]);return(0,a.useEffect)(()=>{null===h&&k.push("/login?error=".concat(encodeURIComponent("You must be logged in to view this page."),"&redirect=").concat(encodeURIComponent("/account"))),h&&b({email:h.email,name:h.name,phone:h.phone,password:"",passwordConfirm:""})},[h,k,b,f]),(0,o.jsxs)("form",{onSubmit:w(C),className:p().form,children:[(0,o.jsx)(c.v,{error:e,success:t,className:p().message}),f?(0,o.jsxs)(a.Fragment,{children:[(0,o.jsxs)("p",{children:["Change your password below, or ",(0,o.jsx)("button",{type:"button",className:p().changePassword,onClick:()=>_(!f),children:"cancel"}),"."]}),(0,o.jsx)(i.I,{name:"password",type:"password",label:"Password",required:!0,register:g,error:y.password}),(0,o.jsx)(i.I,{name:"passwordConfirm",type:"password",label:"Confirm Password",required:!0,register:g,validate:e=>e===x.current||"The passwords do not match",error:y.passwordConfirm})]}):(0,o.jsxs)(a.Fragment,{children:[(0,o.jsx)(i.I,{name:"email",label:"Email Address",required:!0,register:g,error:y.email,type:"email"}),(0,o.jsx)(i.I,{name:"name",label:"Name",register:g,error:y.name}),(0,o.jsx)(i.I,{name:"phone",label:"Phone number",register:g,error:y.phone}),(0,o.jsxs)("p",{children:["Change your account details below, or ",(0,o.jsx)("button",{type:"button",className:p().changePassword,onClick:()=>_(!f),children:"click here"})," to change your password."]})]}),(0,o.jsx)(l.Button,{type:"submit",label:v?"Processing":f?"Change Password":"Update Account",disabled:v,appearance:"primary",className:p().submit})]})}},4780:function(e,r,t){"use strict";t.r(r),t.d(r,{Button:function(){return i}});var o=t(7437);t(2265);var a=t(1396),n=t.n(a),s=t(7636),l=t.n(s);let i=e=>{let{el:r="link",label:t,newTab:a,href:s,appearance:i,className:c,onClick:u,type:d="button",disabled:p,invert:h,children:m}=e,f=r,_=a?{target:"_blank",rel:"noopener noreferrer"}:{},g=[l().button,c,l()["appearance--".concat(i)],h&&l()["".concat(i,"--invert")]].filter(Boolean).join(" "),w=(0,o.jsxs)("div",{className:l().content,children:[(0,o.jsx)("span",{className:l().label,children:t}),m]});if((u||"submit"===d)&&(f="button"),"link"===f)return(0,o.jsx)(n(),{href:s||"",className:g,..._,onClick:u,children:w});let y=f;return(0,o.jsx)(y,{href:s,className:g,type:d,..._,onClick:u,disabled:p,children:w})}},6399:function(e,r,t){"use strict";t.d(r,{I:function(){return s}});var o=t(7437);t(2265);var a=t(1577),n=t.n(a);let s=e=>{let{name:r,label:t,required:a,register:s,error:l,type:i="text",validate:c,disabled:u}=e;return(0,o.jsxs)("div",{className:n().inputWrap,children:[(0,o.jsxs)("label",{htmlFor:"name",className:n().label,children:[t,a?(0,o.jsx)("span",{className:n().asterisk,children:"\xa0*"}):""]}),(0,o.jsx)("input",{className:[n().input,l&&n().error].filter(Boolean).join(" "),type:i,...s(r,{required:a,validate:c,..."email"===i?{pattern:{value:/\S+@\S+\.\S+/,message:"Please enter a valid email"}}:{}}),disabled:u}),l&&(0,o.jsx)("div",{className:n().errorMessage,children:(null==l?void 0:l.message)||(null==l?void 0:l.type)!=="required"?null==l?void 0:l.message:"This field is required"})]})}},1752:function(e,r,t){"use strict";t.d(r,{v:function(){return s}});var o=t(7437);t(2265);var a=t(4690),n=t.n(a);let s=e=>{let{message:r,error:t,success:a,warning:s,className:l}=e,i=r||t||a||s;return i?(0,o.jsx)("div",{className:[n().message,l,t&&n().error,a&&n().success,s&&n().warning,!t&&!a&&!s&&n().default].filter(Boolean).join(" "),children:i}):null}},7992:function(e,r,t){"use strict";t.d(r,{H:function(){return s},a:function(){return l}});var o=t(7437),a=t(2265);let n=(0,a.createContext)({}),s=e=>{let{children:r}=e,[t,s]=(0,a.useState)(),[l,i]=(0,a.useState)(),c=(0,a.useCallback)(async e=>{try{let t=await fetch("".concat("http://localhost:3000","/api/users/create"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,password:e.password,passwordConfirm:e.passwordConfirm})});if(t.ok){var r;let{data:e,errors:o}=await t.json();if(o)throw Error(o[0].message);s(null==e?void 0:null===(r=e.loginUser)||void 0===r?void 0:r.user),i("loggedIn")}else throw Error("Invalid login")}catch(e){throw Error("An error occurred while attempting to login.")}},[]),u=(0,a.useCallback)(async e=>{try{let r=await fetch("".concat("http://localhost:3000","/api/users/login"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,password:e.password})});if(r.ok){let{user:e,errors:t}=await r.json();if(t)throw Error(t[0].message);return s(e),i("loggedIn"),e}throw Error("Invalid login")}catch(e){throw Error("An error occurred while attempting to login.")}},[]),d=(0,a.useCallback)(async()=>{try{let e=await fetch("".concat("http://localhost:3000","/api/users/logout"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"}});if(e.ok)s(null),i("loggedOut");else throw Error("An error occurred while attempting to logout.")}catch(e){throw Error("An error occurred while attempting to logout.")}},[]);(0,a.useEffect)(()=>{let e=async()=>{try{let e=await fetch("".concat("http://localhost:3000","/api/users/me"),{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(e.ok){let{user:r}=await e.json();s(r||null),i(r?"loggedIn":void 0)}else throw Error("An error occurred while fetching your account.")}catch(e){throw s(null),Error("An error occurred while fetching your account.")}};e()},[]);let p=(0,a.useCallback)(async e=>{try{let t=await fetch("".concat("http://localhost:3000","/api/users/forgot-password"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email})});if(t.ok){var r;let{data:e,errors:o}=await t.json();if(o)throw Error(o[0].message);s(null==e?void 0:null===(r=e.loginUser)||void 0===r?void 0:r.user)}else throw Error("Invalid login")}catch(e){throw Error("An error occurred while attempting to login.")}},[]),h=(0,a.useCallback)(async e=>{try{let o=await fetch("".concat("http://localhost:3000","/api/users/reset-password"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e.password,passwordConfirm:e.passwordConfirm,token:e.token})});if(o.ok){var r,t;let{data:e,errors:a}=await o.json();if(a)throw Error(a[0].message);s(null==e?void 0:null===(r=e.loginUser)||void 0===r?void 0:r.user),i((null==e?void 0:null===(t=e.loginUser)||void 0===t?void 0:t.user)?"loggedIn":void 0)}else throw Error("Invalid login")}catch(e){throw Error("An error occurred while attempting to login.")}},[]);return(0,o.jsx)(n.Provider,{value:{user:t,setUser:s,login:u,logout:d,create:c,resetPassword:h,forgotPassword:p,status:l},children:r})},l=()=>(0,a.useContext)(n)},8967:function(e){e.exports={form:"AccountForm_form__lSVWE",changePassword:"AccountForm_changePassword__92rDX",submit:"AccountForm_submit__sVozx"},e.exports.__checksum="7499c6b9d698"},7636:function(e){e.exports={label:"Button_label__pYjjJ",button:"Button_button__QvmpL",content:"Button_content__rz2Uk","appearance--primary":"Button_appearance--primary__aXtFJ","appearance--secondary":"Button_appearance--secondary__67RnZ","primary--invert":"Button_primary--invert__abvn4","secondary--invert":"Button_secondary--invert__OpT85","appearance--default":"Button_appearance--default__Hxo2A","appearance--none":"Button_appearance--none__nd_sY"},e.exports.__checksum="feca588f12e7"},1577:function(e){e.exports={inputWrap:"Input_inputWrap__8dIRM",input:"Input_input__KwwA8",asterisk:"Input_asterisk__YQ6ea",error:"Input_error__qB_Bs",label:"Input_label__4aiDX",errorMessage:"Input_errorMessage__9tcd0"},e.exports.__checksum="3fb30c4ade3e"},4690:function(e){e.exports={message:"Message_message__z1tdG",default:"Message_default__RDDb4",warning:"Message_warning__FT9n8",error:"Message_error__WX2fA",success:"Message_success__Cnnxv"},e.exports.__checksum="e7c05ffe3613"},622:function(e,r,t){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var o=t(2265),a=Symbol.for("react.element"),n=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,l=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function c(e,r,t){var o,n={},c=null,u=null;for(o in void 0!==t&&(c=""+t),void 0!==r.key&&(c=""+r.key),void 0!==r.ref&&(u=r.ref),r)s.call(r,o)&&!i.hasOwnProperty(o)&&(n[o]=r[o]);if(e&&e.defaultProps)for(o in r=e.defaultProps)void 0===n[o]&&(n[o]=r[o]);return{$$typeof:a,type:e,key:c,ref:u,props:n,_owner:l.current}}r.Fragment=n,r.jsx=c,r.jsxs=c},7437:function(e,r,t){"use strict";e.exports=t(622)}},function(e){e.O(0,[724,644,971,864,744],function(){return e(e.s=9899)}),_N_E=e.O()}]);